language: python
sudo: false
python:
- '2.7'
env:
  global:
  - secure: BUm/CFQjB8gJxE4BJ3QVFfJ7NF7PG+REajGCikruo/SwreQWx5lQNL6qN7/bj0FzlU5gyg79oph3BHPFKKgZwXQlQYqsPGyY5NSj9VLZUX9yb/D4oBJcCYLAp3Fa6QvyYAMJUkBPfIawLZ+LHncCiJRID+jhfNMviH0X2R3ZYHHwsE8FFWTvsosYiho47inMZye2SdMxBCli0lqJeUInFFNS2QWmoF4fdWJ4TwNoWHw12LmeO6WoQMy6e/LHqEwD2BaAmokn+aXjqfC+p74nJv5t8dQGbQGc75MjP8i/4GvoJ6Ig9yTtEuYeeDH9vbKpzPHYoJqNVuSJFM2PWQOF764+6yTsTSSyEYkDqngbSC/s+oDAN8lyDpNOjm01EWkkkV9sXsCZV2FvvqSdxNpK5cbDpl5yS+pEWXoFGLsCBGRSSR9OMC2YiCrrz2wTSiziYuGNtPxNn0kJI/JYfMLEZiTGGpT8rRzP/DR2XxP3gy8DKBOOT2xSycAq7jEcMfbxPzIjoXt77nZUeSLu4YiRhsSZOtV/LjpM6J7QqRXch0WUpRxdQO3tFhR5OqxfzSSbvxHSIVjFgM1P0kj8NSMWt2gd3RlyUS0PK5rYs5UsEqPJW1ghyipOMtrAC+7xmDqRsgdBrOb3bFAUq5qeM2XQtZ98MtnQ9jBP0I+9NMF0Tis= # user name stage
  - secure: Kry+ITgVQKOisV8is2zIp6zjNMwwGf1g2cB0nlo37kBTh2TXFcvSbd0lS37IWoOucnaQW4/u3Ylaq7c5hiGgE+8CfjGeMVtfNQW88v+3Y3Fuj44auPRBFuEHn7jRmqjyhJjPACHk2zNI6tKP1CTdQFGUITbMwz9qv22ijckADlNUpk0c796vuhAybfqQXsoeFQ4kiYGCFwxpgrMI8HDyLFDv2Pl4XNwEe/G25VLHzUcUyxpPtYNA2/jXkZfHKgg52CfLrbPeYEzv77tJoQm1Cto3QbeEyM0um1HsovNuOC9Og3yKpRq+Y3dsU8Wf84jiDmR0f4vsNoo0VVRMzKlPVp6INtfgRRDkymNcglQ+6Aj42gMNnoZkLrbL6ixZxY0tCHfo+tKFltuaA8cgPJmjwEjLPtlOC1sNHPZeaarAuuJugRrZ91WWVbiQkIr3ZSCUMF+MNGALiB14aZ5kqmTgb+cCzfbLTmR55UzCtgosa6qgdKSZ31RLGg3UpZab37omWE1VaZt4uwWh5vqCkgGADBK022TqxdobDN1wwDZsHAgpbFyhah3MebkOI9vv2fNL2Pa06viunJZ1Cw140OrloXhXP/9uEIx7ozOaRb2gkSUK4G4vkPwQa/iHlHn0DZzw/AhRxiv5wHn3MJLtKYeneZUKYZ8WC2bsI19aUmNobaI= # password stage
  - secure: BIqLQBY+4yIGHq6Qmp9LAzQr5jDCVBMaiatlzxUvfcHShpRWqWZ0BN6IkMesqafjLyu5SzNxNGXmVz6IGKDMxLCtI350fwrjSgOJzJW4llaSeHT12XklE7KjtFO2zZzhFknzRcjhjTFk/dy8C65NKNfc0OK2xTnLAFs1On62Q8u9L2gpofCicpQ7yenIAFpw9gxaSU6WrzMdNR8lcQI/9F1ao5trY4MIt5GscBibDe+2FXaFautS4Y2eIxqSHjV+Eb2PldaiENnnorDS0kj8xN4icnrgU9X4wf16L3x48F5O4Vdpmr0Iv3R/oMXF/pV+yoi00ouCboWrUcgdPg7qeqNp/vZo/Ew43ifN3RD+mdZ/3L12ItDLksE6DB1ElWbFopz+wSbU7g1i+592hViXyx+Fb6lUvXceqjwOzQsBQn/1auhhlOSpJ1VQ47vvWsV/N8eJyjW0LqB/LeVtxgF3G7QrYYGl0wa3rQnAio2rg3c08cBeSTe0XI5EYOk2v1YkisCI/z3gRGCtK6RSh86CJGv4mgv2xYWjwfoZM/kIDn1I3xvFuZ0jGDhPu7P0o/t5oZb7End4k9expu3zSDbu02zu+Mq7uE6vH6N0YZY8nC0yJIFt5ge0Z0ojEMo0YKrHvnIiLWU9oYTaeo0Md+ZYAivWnRAiDBY1i8JzFLnEhuw= # dev username
  - secure: RMZnD7ktcxq0TSOanEr9Q6yTlCj+f38EgPgxxYL6+tSP5PxupaacvTOxLfe0ktn8MuGAA/+WRvSFy5tGeUiJ5Y2UoT6JEGuhlCI1ax9xxTE+r26GLQJml0xvebGh3jqXIkLmRELyY/u9jS6EmjFoWCk9YGkWrBj20qhf+lK0HQWoWCn/o/hJC2CdaY0e3ImzVmQAkgOlynVdii8souTRSusB3tdKcyQCMsl2lYw2kNZ2kaxdYCCYXNh/osiSUGVgXWplfXepO//l6j0IxGYSKEJWz9igWpxfYpdIMI6RLZVmwxtHCBZ/V65i6CPhc5FbmIVfbQIDUItFDGYhcxUL+JPyYAgKtrhu2xMvxdKZ95tz5Nogh83qy3iogO8JTaqRw2eCK5MbTAJ7/hLjR6fWU/aJTcLq6fbm+eeUNGW8KN4VYkc7yI2DuAtXsHLTGd12pYsnPCDpb+myLapPKJhlbcm0Qg2K2XN7sKYGX/MUPSgHlyK19W+kxGoa4+1kCoHqkfy7aLMwBTy+YqsWaq6v+ZmmqwJYo03VCW6dPvS9+/Qi++pRDi97WLhyUwHVKH8KCJRDPPSezmPBtCK2+cC8531NffXGAbOUH7dD5q0OMF1yolYrLeaKUqGR2urqjAOKhmCmfHVB8AdRs5veEsjgDN0cJ9w9qI15akIKpwAyEtc= # dev password
  - secure: IEtTPH6takzywyw4efkS1x7voHsLO0zwYXmwcd0ILeylA4vF3gJwqQwDFyHGbhyb62bsgfZcoZ8MWaAfj7q4xm8DmYrF3ycLTUyf5uw3Q/X/3hmkOOGpKgCkCyJy9t7u05iLYAZZiqTWsEY1NjqvDRoojUOxKvN7xAY2DukWQbMw+MGFwev16LrJ9GOWVyBdlqCFewHeLFKx+/F30uO1Gsjs2lNI8LzuthwFdRBHrjRFyjOq0ECPjRRvOo/UBzfJpz65GM61RojOvTsj3Bsc5/EU3wVcXQTdsREaX6pkSnDDoMRWfpBFmRwmS05b0ag33eAG5lrVz1d/z/poUbiIQ+9FSr/p7Dub4vcpVnMzVDhZwtEEP2HBHiHTNq9tp4gBCjfTO+BDcLBIFnhZzzPI0B90Q3q6ZdxRjvCc6gMdnlU9GIMJHeTk9KXWGbUpxb/yg1enl7sAEwr+TnCGbWbD/ESJ6WhR/IqXxNYJ3CaQ/dXoRdQvH7AKanlr+yCSr/q9GAyjQqDDYTKxaYdI6QKIFvrouHxqcklNy+PsowagHP9qsTkqNAOEGoSj0i6WVvhsJ7PQj5jdoUWG1W3Z6HUo4+1849dGMeST3VT50oCSrYuYQO11PU6AZgvzLuMPMQ8VKXazdvgNw70NC6J1MDaFIfLJRCsNfEiOS7ZL+oA2A44= # prod user name
  - secure: NgiOxsm6boq0Y7HlAt4oUMOPAQRRxPDgBQGg8GhEmuqh5eseeP58qaY5aFEcyoaOZrzE7ywbIOYdwuGROId3HlHzHjdh2Uug+2MwSl2r+wZoS4oa8RfhY1fRhRrP8udWUZYpev1FuYvCbqoCA3LVfubBNASRirq7r0U8Xu8qzkxI2E9T3/cHSMMgzx/3Arb4uAccJiuZzQ1yuahOmwm9zhnFfHyJ27lcvrNQrWE5enujUCAawb0EQIQ6NLv9VkBirN2mJpWBW9wmSk5Fll3pQs0pk2cZXc4UZcc7esjtJmejOerXxtpVod8z4Kx9qGZqGQWXhK27BoulvBW871IXOel5WKq8s8JjwMpG96iLOMVtsWlQ8VxNO7vttvTYXLipTLWyW/BoPFBJKKgFA+8J62k63DdMheSynr2h4APybOQPjwU8BwnbA0rP2IYKIogu14WeSyErkrlTUIoYRnpKCJpX5vxJHI0ORtT1ZeqRVw6iwgIm3XjQQYXuicFFFWKBVX6VfjEAsKfK6BfLtltgpHEGdkleegrx5lJefxVEgzzxfUP89bN4wTuI5+P8FAhQJRsbRzQauDh62+qYEoTyYawRam8RKSwoQuXmiMvs9XtvlRLCeKm1gjtoqidc8xqiXrZsgSKtzgo6GrVmbv1nOWv0psHBNYh9VIvVHaXIT0U= # prod password
before_install:
- gem install sass
install:
- pip install -r requirements.txt
- pip install -r requirements_test.txt
- pip install -r requirements_dev.txt
- npm install -g grunt-cli bower
- npm install
script:
- npm run build
- python manage.py migrate --fake-initial
- python manage.py compile_frontend
- python manage.py test
before_deploy:
- travis_retry pip install bandit
- cd ..
- bandit -r fec-eregs/fec_eregs "fec_eregs/*.py"
- cd fec-eregs
- mkdir $HOME/bin
- export PATH=$HOME/bin:$PATH
- travis_retry curl -L "https://cli.run.pivotal.io/stable?release=linux64-binary&version=6.25.0" | tar xzv -C $HOME/bin
- travis_retry cf install-plugin autopilot -f -r CF-Community
after_deploy:
- curl --silent --fail --head https://fec-dev-eregs.app.cloud.gov/regulations || travis_terminate $?
- curl --silent --fail --get https://fec-dev-eregs.app.cloud.gov/regulations/api/regulation/2 > /dev/null || travis_terminate $?
deploy:
  provider: script
  skip_cleanup: true
  script: invoke deploy --branch $TRAVIS_BRANCH --login True --yes
  on:
    all_branches: true
